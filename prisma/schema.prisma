generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id          String     @id @default(uuid())
  name        String
  description String?
  parentId    String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  parent      Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryToCategory")
  products    Product[]
}

model Product {
  id                 String              @id @default(uuid())
  name               String
  description        String?
  sku                String              @unique
  barcode            String?
  unit               String
  costPrice          Float
  sellingPrice       Float
  taxRate            Float?              @default(0)
  reorderLevel       Int                 @default(0)
  status             String              @default("ACTIVE")
  categoryId         String?
  supplierId         String?
  isDeleted          Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  onlineOrderItems   OnlineOrderItem[]
  category           Category?           @relation(fields: [categoryId], references: [id])
  purchaseItems      PurchaseItem[]
  saleItems          SaleItem[]
  ledgerEntries      StockLedger[]
  stockTransferItems StockTransferItem[]
  variants           Variant[]
}

model Variant {
  id            String     @id @default(uuid())
  productId     String
  name          String
  sku           String     @unique
  barcode       String?
  costPrice     Float?
  sellingPrice  Float?
  stockQuantity Int        @default(0)
  isDeleted     Boolean    @default(false)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  saleItems     SaleItem[]
  product       Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Warehouse {
  id              String          @id @default(uuid())
  name            String
  location        String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  purchases       Purchase[]
  sales           Sale[]
  ledgerEntries   StockLedger[]
  destTransfers   StockTransfer[] @relation("DestWarehouse")
  sourceTransfers StockTransfer[] @relation("SourceWarehouse")
}

model StockTransfer {
  id                String              @id @default(uuid())
  transferNumber    String              @unique
  sourceWarehouseId String
  destWarehouseId   String
  date              DateTime            @default(now())
  status            String              @default("COMPLETED")
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  destWarehouse     Warehouse           @relation("DestWarehouse", fields: [destWarehouseId], references: [id])
  sourceWarehouse   Warehouse           @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
  items             StockTransferItem[]
}

model StockTransferItem {
  id         String        @id @default(uuid())
  transferId String
  productId  String
  quantity   Int
  product    Product       @relation(fields: [productId], references: [id])
  transfer   StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
}

model StockLedger {
  id             String    @id @default(uuid())
  productId      String
  variantId      String?
  warehouseId    String
  quantityChange Int
  type           String
  referenceId    String?
  note           String?
  userId         String
  createdAt      DateTime  @default(now())
  product        Product   @relation(fields: [productId], references: [id])
  warehouse      Warehouse @relation(fields: [warehouseId], references: [id])
}

model Party {
  id             String        @id @default(uuid())
  name           String
  type           String
  phone          String
  email          String?
  address        String
  openingBalance Float         @default(0)
  currentBalance Float         @default(0)
  status         String        @default("ACTIVE")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  ledgers        PartyLedger[]
  payments       Payment[]
  purchases      Purchase[]
  sales          Sale[]
}

model Payment {
  id         String        @id @default(uuid())
  partyId    String
  amount     Float
  method     String
  type       String
  reference  String?
  date       DateTime
  note       String?
  createdAt  DateTime      @default(now())
  accountId  String?
  purchaseId String?
  saleId     String?
  ledgers    PartyLedger[]
  account    Account?      @relation(fields: [accountId], references: [id])
  party      Party         @relation(fields: [partyId], references: [id], onDelete: Cascade)
  purchase   Purchase?     @relation(fields: [purchaseId], references: [id])
  sale       Sale?         @relation(fields: [saleId], references: [id])
}

model PartyLedger {
  id             String   @id @default(uuid())
  partyId        String
  paymentId      String?
  transactionId  String?
  date           DateTime
  description    String
  type           String
  amount         Float
  runningBalance Float
  createdAt      DateTime @default(now())
  party          Party    @relation(fields: [partyId], references: [id], onDelete: Cascade)
  payment        Payment? @relation(fields: [paymentId], references: [id])
}

model Sale {
  id             String     @id @default(uuid())
  saleNumber     String     @unique
  customerId     String
  warehouseId    String
  totalAmount    Float
  discountAmount Float      @default(0)
  taxAmount      Float      @default(0)
  netAmount      Float
  paidAmount     Float      @default(0)
  balanceAmount  Float      @default(0)
  paymentStatus  String
  status         String     @default("COMPLETED")
  userId         String
  notes          String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  taxRate        Float      @default(0)
  invoice        Invoice?
  payments       Payment[]
  customer       Party      @relation(fields: [customerId], references: [id])
  warehouse      Warehouse  @relation(fields: [warehouseId], references: [id])
  items          SaleItem[]
}

model SaleItem {
  id               String   @id @default(uuid())
  saleId           String
  productId        String
  variantId        String?
  quantity         Int
  unitPrice        Float
  discountAmount   Float    @default(0)
  taxAmount        Float    @default(0)
  totalAmount      Float
  costPrice        Float    @default(0)
  returnedQuantity Int      @default(0)
  product          Product  @relation(fields: [productId], references: [id])
  sale             Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  variant          Variant? @relation(fields: [variantId], references: [id])
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String
  action     String
  entityType String
  entityId   String
  details    String?
  createdAt  DateTime @default(now())
}

model Invoice {
  id            String   @id @default(uuid())
  saleId        String   @unique
  invoiceNumber String   @unique
  invoiceDate   DateTime @default(now())
  totalAmount   Float
  pdfUrl        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  sale          Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
}

model Purchase {
  id             String         @id @default(uuid())
  purchaseNumber String         @unique
  supplierId     String
  warehouseId    String
  totalAmount    Float
  taxAmount      Float          @default(0)
  netAmount      Float
  paidAmount     Float          @default(0)
  balanceAmount  Float          @default(0)
  status         String         @default("COMPLETED")
  paymentStatus  String         @default("UNPAID")
  date           DateTime       @default(now())
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  payments       Payment[]
  supplier       Party          @relation(fields: [supplierId], references: [id])
  warehouse      Warehouse      @relation(fields: [warehouseId], references: [id])
  items          PurchaseItem[]
}

model PurchaseItem {
  id         String   @id @default(uuid())
  purchaseId String
  productId  String
  quantity   Int
  unitCost   Float
  totalCost  Float
  product    Product  @relation(fields: [productId], references: [id])
  purchase   Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
}

model ExpenseCategory {
  id          String    @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  expenses    Expense[]
}

model Expense {
  id            String          @id @default(uuid())
  categoryId    String
  amount        Float
  date          DateTime        @default(now())
  description   String?
  reference     String?
  paidBy        String?
  paymentMethod String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  accountId     String?
  account       Account?        @relation(fields: [accountId], references: [id])
  category      ExpenseCategory @relation(fields: [categoryId], references: [id])
}

model Account {
  id            String    @id @default(uuid())
  name          String
  type          String
  accountNumber String?
  balance       Float     @default(0)
  currency      String    @default("USD")
  description   String?
  isDefault     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  expenses      Expense[]
  payments      Payment[]
}

model OnlineOrder {
  id              String            @id @default(uuid())
  orderNumber     String            @unique
  customerName    String
  customerEmail   String
  customerPhone   String
  shippingAddress String
  totalAmount     Float
  status          String            @default("PENDING")
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  items           OnlineOrderItem[]
}

model OnlineOrderItem {
  id            String      @id @default(uuid())
  onlineOrderId String
  productId     String
  quantity      Int
  unitPrice     Float
  totalPrice    Float
  onlineOrder   OnlineOrder @relation(fields: [onlineOrderId], references: [id], onDelete: Cascade)
  product       Product     @relation(fields: [productId], references: [id])
}

model SubscriptionPlan {
  id        String     @id @default(uuid())
  name      String
  price     Float
  duration  Int
  features  String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  isActive  Boolean    @default(true)
  settings  Settings[]
}

model Settings {
  id                 String            @id @default(uuid())
  
  // Basic Information
  businessName       String
  legalName          String?           // Legal business name
  logo               String?           // Logo URL/path
  
  // Contact Information  
  address            String?
  phone              String?
  email              String?
  website            String?           // Business website
  
  // Financial Settings
  currency           String            @default("USD")
  taxRate            Float             @default(0)
  taxId              String?           // Tax/VAT number
  
  // Invoice Customization
  invoiceFooter      String?           // Custom footer for invoices
  
  // Social Links (JSON)
  socialLinks        String?           // JSON string of social media links
  
  // Timestamps
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  
  // Subscription
  subscriptionPlanId String?
  subscriptionPlan   SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])
}
